Автоматизация развертывания и аварийного восстановления виртуальной инфраструктуры
============================

Данный репозиторий содержит код автоматизации развертывания и аварийного восстановления виртуальной инфраструктуры.

Состав инфраструктуры:
----------------------
Основой инфраструктуры служит bare-metal сервера, которые представляют из себя кластер proxmox virtual environment (PVE). Вся разворачиваемая инфраструктура является совокупностью виртуальных машин, работающих внутри этого кластера. 
|          роль сервера         | кол-во серверов | наименования серверов |                        реализация роли                       |
|:-----------------------------:|:---------------:|:---------------------:|:------------------------------------------------------------:|
| сервера балансировки нагрузки |        2        |       lb01, lb02      |                       keepalived, nginx                      |
|     сервера веб-приложения    |        2        |      app01, app02     |                       nginx, wordpress                       |
|      сервера баз данных      |        2        |       db01, db02      |                             mysql                            |
|      сервера мониторинга      |        1        |         mon01         | node-exporter, cadvisor, nginx-exporter, prometheus, grafana |
|      сервера логирования      |        1        |         log01         |           filebeat, logstash, elasticsearch, kibana          |

Состав инструментов автоматизации:
--------------------
| инструмент |              роль             |
|:----------:|:-----------------------------:|
|  opentofu  | развертывание инфраструктуры  |
|   ansible  |    настройка инфраструктуры   |

Инструкция по развертыванию или аварийному восстановлению виртуальной инфраструктуры:
---------------------
Клонируйте данный репозиторий на сервер, с которого будут проводиться работы:
```sh
git clone git@github.com:MaxCurly/linux_base_2024_07_project.git
```
Перейдите в директорию клонированного репозитория:
```sh
cd ./linux_base_2024_07_project
```
Запустите инициализацию opentofy:
```sh
tofy init
```
Запустите планирование инфраструктуры при помощи tofu: 
```sh
tofy plan
```
Запустите развертывание инфраструктуры при помощи tofu: 
```sh
tofy apply
```
> Обратите внимание: сделайте паузу перед переходом к дальнейшим действиям (после развертывания сервера обновляют пакетнуюь базу в автоматическом режиме, обычно это занимает несколько минут)

Запустите настройку серверов логирования при помощи ansible: 
```sh
ansible-playbook -i inventories/log/main.yml main.yml --ask-vault-pass
```
Запустите настройку серверов мониторинга при помощи ansible: 
```sh
ansible-playbook -i inventories/mon/main.yml main.yml --ask-vault-pass
```
Запустите настройку серверов баз данных при помощи ansible: 
```sh
ansible-playbook -i inventories/db/main.yml main.yml --ask-vault-pass
```
Запустите настройку серверов веб приложений при помощи ansible: 
```sh
ansible-playbook -i inventories/app/main.yml main.yml --ask-vault-pass
```
Запустите настройку серверов балансировки нагрузки при помощи ansible: 
```sh
ansible-playbook -i inventories/lb/main.yml main.yml --ask-vault-pass
```

Автор: MaxCurly (Maxim Kudryashov m.v.kudryashov@ya.ru)
